#!/usr/bin/make -f

export DH_VERBOSE = 1
export PYBUILD_NAME = tuf

PYVERS ?= $(shell py3versions -rv)
TOX_OPTIONS += --sitepackages

%:
	dh $@ --with python3  --buildsystem=pybuild

override_dh_install:
	dh_install
	rm -rfv debian/*/usr/bin/*.py

override_dh_auto_test:
ifeq (,$(findstring nocheck,$(DEB_BUILD_OPTIONS)))
	tox -l
	set -e ; for py in $(PYVERS); do \
	  env=$$(echo "py$${py}" | tr -d '.') ; \
	  tox ${TOX_OPTIONS} -e "$${env}" -- -s ; \
	done
endif

override_dh_auto_clean:
	rm -rf .tox
	dh_auto_clean

override_dh_installdocs:
	dh_installdocs -ppython-${PYBUILD_NAME}-doc --doc-main-package=python3-${PYBUILD_NAME}
	dh_installdocs --remaining-packages
	ln -fs ${PYBUILD_NAME}-spec.md \
          debian/python-${PYBUILD_NAME}-doc/usr/share/doc/python3-${PYBUILD_NAME}/docs/${PYBUILD_NAME}-spec.txt

